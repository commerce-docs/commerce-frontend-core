"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[9300],{25545:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return l},default:function(){return c}});var a=n(58168),o=n(80045),r=(n(88763),n(15680)),i=n(83407);const d=["components"],l={},m=(p="InlineAlert",function(e){return console.warn("Component "+p+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)});var p;const u={_frontmatter:l},s=i.A;function c(e){let{components:t}=e,n=(0,o.A)(e,d);return(0,r.mdx)(s,(0,a.A)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"migrate-content-from-custom-blocks"},"Migrate content from custom blocks"),(0,r.mdx)("p",null,"This topic describes how to migrate content from your custom BlueFoot blocks to Page Builder custom content types."),(0,r.mdx)("p",null,"The example code used in this topic is for migrating the data for a custom BlueFoot block called ",(0,r.mdx)("inlineCode",{parentName:"p"},"list"),"."),(0,r.mdx)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.mdx)("p",null,"This topic assumes you have taken the following actions:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"Migrated the core BlueFoot blocks")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"Familiarized yourself with our ",(0,r.mdx)("a",{parentName:"p",href:"how-content-migration-works.md"},"content type renderers"),".")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"Familiarized yourself with the ",(0,r.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/commerce/php/development/prepare/extension-lifecycle/"},"module lifecycle"),".")),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"Re-implemented your custom BlueFoot block as a new Page Builder content type."),(0,r.mdx)("p",{parentName:"li"},"This prerequisite is the most time-consuming. But with careful planning, you can build a simpler version of your BlueFoot block in Page Builder."))),(0,r.mdx)("h2",{id:"step-1-increase-version"},"Step 1: Increase version"),(0,r.mdx)("p",null,"Increase your module's ",(0,r.mdx)("inlineCode",{parentName:"p"},"version")," in the ",(0,r.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/commerce/php/development/build/composer-integration/"},(0,r.mdx)("inlineCode",{parentName:"a"},"composer.json"))," file."),(0,r.mdx)("p",null,"This causes Adobe Commerce to run your module's setup scripts during the migration process."),(0,r.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"Follow Commerce's ",(0,r.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/commerce/php/development/versioning/"},"versioning policy")," when deciding the value of your module's next version."),(0,r.mdx)("h2",{id:"step-2-add-page-builder-dependency"},"Step 2: Add Page Builder dependency"),(0,r.mdx)("p",null,"Add the ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento_PageBuilder")," module dependency to your ",(0,r.mdx)("inlineCode",{parentName:"p"},"composer.json")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"module.xml")," files."),(0,r.mdx)("p",null,"This gives your module access to the required migration API during the migration."),(0,r.mdx)("h2",{id:"step-3-build-the-renderer"},"Step 3: Build the renderer"),(0,r.mdx)("p",null,"The renderer contains the data conversion code for your content type. It converts the BlueFoot JSON to the HTML storage format used by Page Builder content types."),(0,r.mdx)("p",null,"Create the following class under ",(0,r.mdx)("inlineCode",{parentName:"p"},"Setup/DataConverter/Renderer")," and implement the following interface:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"Magento\\PageBuilder\\Setup\\DataConverter\\RendererInterface\n")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"namespace VendorName\\ModuleName\\Setup\\DataConverter\\Renderer;\n\nuse Magento\\PageBuilder\\Setup\\DataConverter\\RendererInterface;\nuse Magento\\PageBuilder\\Setup\\DataConverter\\EavAttributeLoaderInterface;\nuse Magento\\PageBuilder\\Setup\\DataConverter\\StyleExtractorInterface;\n\nclass List implements RendererInterface\n{\n    /**\n     * @var EavAttributeLoaderInterface\n     */\n    private $eavAttributeLoader;\n\n    public function __construct(\n        EavAttributeLoaderInterface $eavAttributeLoader\n    ) {\n        $this->eavAttributeLoader = $eavAttributeLoader;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function render(array $itemData, array $additionalData = [])\n    {\n        $eavData = $this->eavAttributeLoader->load($itemData['entityId']);\n\n        return '<div>Your output HTML here</div>';\n    }\n}\n")),(0,r.mdx)("h2",{id:"step-4-add-renderer-to-the-renderpool"},"Step 4: Add renderer to the RenderPool"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"RenderPool")," maps BlueFoot blocks to the renderers that migrate their content. You can find the existing renderers in ",(0,r.mdx)("inlineCode",{parentName:"p"},"app/code/Magento/PageBuilderDataMigration/etc/di.xml"),"."),(0,r.mdx)("p",null,"The migration module uses the ",(0,r.mdx)("inlineCode",{parentName:"p"},"RenderPool")," in the ",(0,r.mdx)("inlineCode",{parentName:"p"},"di.xml")," file to find the renderer to run for a given block type. For example, if the migration module encounters a BlueFoot entity type of ",(0,r.mdx)("inlineCode",{parentName:"p"},"row"),", it searches for the name ",(0,r.mdx)("inlineCode",{parentName:"p"},"row")," in the ",(0,r.mdx)("inlineCode",{parentName:"p"},"RenderPool"),". If it finds the name, it runs the associated renderer to migrate the row content."),(0,r.mdx)("p",null,"The same logic applies to your ",(0,r.mdx)("em",{parentName:"p"},"custom")," BlueFoot blocks. If the name of your custom block is ",(0,r.mdx)("inlineCode",{parentName:"p"},"list"),", you must add it to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"RenderPool")," in your module's ",(0,r.mdx)("inlineCode",{parentName:"p"},"di.xml")," file. If you don't add it, the migration module will not migrate your the content from your ",(0,r.mdx)("inlineCode",{parentName:"p"},"list")," block."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-xml"},'<type name="Magento\\PageBuilder\\Setup\\DataConverter\\RendererPool">\n    <arguments>\n        <argument name="renderers" xsi:type="array">\n            <item name="list" xsi:type="object">VendorName\\ModuleName\\Setup\\DataConverter\\Renderer\\List</item>\n        </argument>\n    </arguments>\n</type>\n')),(0,r.mdx)("p",null,"Example: List renderer ",(0,r.mdx)("inlineCode",{parentName:"p"},"di.xml")," entry"),(0,r.mdx)("h2",{id:"step-5-run-migration"},"Step 5: Run migration"),(0,r.mdx)("p",null,"If you have not run the migration module yet, do it now using the following command:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:upgrade\n")),(0,r.mdx)("h2",{id:"step-6-add-a-new-setup-patch"},"Step 6: Add a new setup patch"),(0,r.mdx)("p",null,"Create a new data patch inline with our ",(0,r.mdx)("a",{parentName:"p",href:"https://devdocs.magento.com/guides/v2.3/extension-dev-guide/declarative-schema/data-patches.html"},"declarative schema documentation"),". For this migration, we first declare the following dependencies in the constructor:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Framework\\EntityManager\\MetadataPool"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Framework\\DB\\AggregatedFieldDataConverter"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Framework\\DB\\Select\\QueryModifierFactory"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\Framework\\DB\\FieldToConvert"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("inlineCode",{parentName:"p"},"Magento\\PageBuilder\\Setup\\DataConverter\\MixedToPageBuilder")))),(0,r.mdx)(m,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"The migration module migrates the content from unknown BlueFoot blocks into HTML Code content types. To migrate this content into other content types, use the ",(0,r.mdx)("inlineCode",{parentName:"p"},"MixedToPageBuilder")," data converter."),(0,r.mdx)("p",null,"The following example uses the ",(0,r.mdx)("inlineCode",{parentName:"p"},"MixedToPageBuilder")," class to convert content from CMS pages (cms_page), CMS blocks (cms_block), product attributes (catalog_product_entity_text), and catalog attributes (catalog_category_entity_text):"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"$pageMetadata = $this->metadataPool->getMetadata(PageInterface::class);\n$blockMetadata = $this->metadataPool->getMetadata(BlockInterface::class);\n$this->aggregatedFieldConverter->convert(\n    [\n        new FieldToConvert(\n            DataConverter\\MixedToPageBuilder::class,\n            $this->setup->getTable('cms_page'),\n            $pageMetadata->getIdentifierField(),\n            'content',\n            $this->createQueryModifier('content', Format::BLUEFOOT_KEY)\n        ),\n        new FieldToConvert(\n            DataConverter\\MixedToPageBuilder::class,\n            $this->setup->getTable('cms_block'),\n            $blockMetadata->getIdentifierField(),\n            'content',\n            $this->createQueryModifier('content', Format::BLUEFOOT_KEY)\n        ),\n        new FieldToConvert(\n            DataConverter\\MixedToPageBuilder::class,\n            $this->setup->getTable('catalog_product_entity_text'),\n            'value_id',\n            'value',\n            $this->createQueryModifier('value', Format::BLUEFOOT_KEY)\n        ),\n        new FieldToConvert(\n            DataConverter\\MixedToPageBuilder::class,\n            $this->setup->getTable('catalog_category_entity_text'),\n            'value_id',\n            'value',\n            $this->createQueryModifier('value', Format::BLUEFOOT_KEY)\n        )\n    ],\n    $this->setup->getConnection()\n);\n")),(0,r.mdx)("h2",{id:"step-7-run-migration-again"},"Step 7: Run migration again"),(0,r.mdx)("p",null,"Run the following command to start your module's migration process:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:upgrade\n")),(0,r.mdx)("h2",{id:"next-steps"},"Next steps"),(0,r.mdx)("p",null,"If you have content in other tables, continue to the next step: ",(0,r.mdx)("a",{parentName:"p",href:"migrate-other-bluefoot-content.md"},"Migrate other BlueFoot content"),"."))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-page-builder-migration-migrate-content-custom-blocks-md-aa19a7caccbc516596ee.js.map