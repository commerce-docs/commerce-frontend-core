"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[3435],{20441:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return s},default:function(){return h}});var n=a(58168),o=a(80045),i=(a(88763),a(15680)),r=a(83407);const l=["components"],s={},d=(p="InlineAlert",function(e){return console.warn("Component "+p+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.mdx)("div",e)});var p;const m={_frontmatter:s},c=r.A;function h(e){let{components:t}=e,a=(0,o.A)(e,l);return(0,i.mdx)(c,(0,n.A)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"data-sourcing"},"Data sourcing"),(0,i.mdx)("p",null,"The application provides the DataSource object, which is designed to interact with data in your UI component. Many of the core UI components use this DataSource component. Many UI components require that this object is included. However, there are specific requirements it has in order for it to work correctly."),(0,i.mdx)("p",null,"In this topic, we will explain how to take advantage of the powerful functionality of the data provider in a UI Component."),(0,i.mdx)("h2",{id:"declaring-the-xml"},"Declaring the XML"),(0,i.mdx)("p",null,"The DataSource UI component can be included with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"<dataSource />")," node in the component's top-level configuration file. The ",(0,i.mdx)("inlineCode",{parentName:"p"},"name")," attribute is recommended and should follow the ",(0,i.mdx)("inlineCode",{parentName:"p"},"%instance_name%_data_source")," pattern where ",(0,i.mdx)("inlineCode",{parentName:"p"},"%instance_name%")," is the name of the component."),(0,i.mdx)("p",null,"The component's data provider class is declared inside ",(0,i.mdx)("inlineCode",{parentName:"p"},"<dataSource />"),". The following provides an example and demonstrates what nodes are required."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-xml"},'<argument name="dataProvider" xsi:type="configurableObject">\n    <argument name="class" xsi:type="string">[YourNameSpace]\\[YourModule]\\Ui\\DataProvider\\[YourComponentName]\\DataProvider</argument>\n    <argument name="name" xsi:type="string">[YourComponentName]_data_source</argument>\n    <argument name="primaryFieldName" xsi:type="string">entity_id</argument>\n    <argument name="requestFieldName" xsi:type="string">id</argument>\n</argument>\n')),(0,i.mdx)("p",null,"In the block of code above, ","[YourNameSpace]","[","YourModule] would be the directory that contains all of the module's files and directories. ","[YourComponentName]"," is the name of this instance of a component, which should be the file name as well."),(0,i.mdx)("p",null,"The main node of interest is ",(0,i.mdx)("inlineCode",{parentName:"p"},'<argument name="class" />.')," This references a PHP class that must implement ",(0,i.mdx)("inlineCode",{parentName:"p"},"\\Magento\\Framework\\View\\Element\\UiComponent\\DataProvider\\DataProviderInterface"),". To meet that requirement, it can extend or implement the ","[",(0,i.mdx)("inlineCode",{parentName:"p"},"\\Magento\\Ui\\DataProvider\\ModifierPoolDataProvider"),"]"," class which inherits the ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4/app/code/Magento/Ui/DataProvider/AbstractDataProvider.php"},(0,i.mdx)("inlineCode",{parentName:"a"},"\\Magento\\Ui\\DataProvider\\AbstractDataProvider")),". The ",(0,i.mdx)("inlineCode",{parentName:"p"},"AbstractDataProvider")," class implements all of the required methods in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"DataProviderInterface"),". The DataProvider class is the primary source of any data or metadata that the component needs or will use."),(0,i.mdx)("p",null,"While the XML tells the application about the component's data provider, the application does not do anything in particular with that unless you hook it up to the component's main PHP class. To make the data available in JavaScript, add a ",(0,i.mdx)("inlineCode",{parentName:"p"},"getDataSourceData()")," method to the UI component's PHP class and return ",(0,i.mdx)("inlineCode",{parentName:"p"},"$this->getContext()->getDataProvider()->getData()"),". This will output the result of the data provider's ",(0,i.mdx)("inlineCode",{parentName:"p"},"getData()")," method into the JSON that is sent to the browser along with the rest of the UI component's configuration."),(0,i.mdx)("p",null,"Declare a ",(0,i.mdx)("inlineCode",{parentName:"p"},"getData()")," method in the data provider class that was referenced in the XML and return a value. Since that output will be part of the JSON rendered on the page, it is accessible via the JavaScript class that is associated with the UI component and handles its behavior. Magento's Form Provider JavaScript class is often a good place to start."),(0,i.mdx)(d,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,'A JavaScript "component" is actually a JavaScript file loaded through RequireJS. It should return a JavaScript object that defines a module or function. Do not confuse JavaScript components with UI components.'),(0,i.mdx)("p",null,"Include the Form Provider JavaScript component by adding this inside the ",(0,i.mdx)("inlineCode",{parentName:"p"},"<dataSource />")," node:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-xml"},'<argument name="data" xsi:type="array">\n    <item name="js_config" xsi:type="array">\n        <item name="component" xsi:type="string">Magento_Ui/js/form/provider</item>\n    </item>\n</argument>\n')),(0,i.mdx)("p",null,"This will include ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4/app/code/Magento/Ui/view/base/web/js/form/provider.js"},(0,i.mdx)("inlineCode",{parentName:"a"},"Magento/Ui/view/base/web/js/form/provider.js"))," on the page as part of this DataSource component. The Form Provider JavaScript can also be extended if the functionality doesn't do what is necessary in your case."),(0,i.mdx)("p",null,'Remember that this data provider is still, technically speaking, a completely separate UI Component. To fully link it to the "base" component, there are a few things that need to happen so that the "base" UI component\'s JavaScript can use the data provided by the data provider.'),(0,i.mdx)("p",null,'A good way to keep configuration data out of the JavaScript is to declare a "provider" in the base component\'s XML so it will be able to find that data provider component. Under the ',(0,i.mdx)("inlineCode",{parentName:"p"},'<argument name="data" />')," node, add a node like this (where ",(0,i.mdx)("inlineCode",{parentName:"p"},"[ComponentName]")," is the name of the component):"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-xml"},'<item name="js_config" xsi:type="array">\n    <item name="provider" xsi:type="string">[ComponentName].[ComponentName]_data_source</item>\n</item>\n')),(0,i.mdx)("p",null,"This example declares the name of the data provider class and will be output in the JSON that contains the UI component's configuration. It can then be used to locate the data source component. This is essentially declaring a variable that will be available to a JavaScript class."),(0,i.mdx)("h2",{id:"javascript-template-literals"},"JavaScript template literals"),(0,i.mdx)("p",null,"Throughout Magento's core JavaScript components there are strings like this: ",(0,i.mdx)("inlineCode",{parentName:"p"},"'${ $.provider }:data.totalRecords'"),". These are ES2015 ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals"},"template literals"),". The ",(0,i.mdx)("inlineCode",{parentName:"p"},"${ }")," surrounds an expression that will be parsed as JavaScript. ",(0,i.mdx)("inlineCode",{parentName:"p"},"$.provider")," is the expression, in this example."),(0,i.mdx)("p",null,"The template literal is in a single-quote string, however, not the back-ticks which are standard for ES2015. As a result, they would normally be treated as a string. Since the application needs to support browsers that don't recognize template literals a special interpreter was built for them. If the browser does support standard back-tick template literals, the application will use that, and if not, it evaluates the value manually."),(0,i.mdx)("p",null,"When the component is initialized, it will automatically evaluate all string literals in properties. In the example above, ",(0,i.mdx)("inlineCode",{parentName:"p"},"$.provider")," will become  ",(0,i.mdx)("inlineCode",{parentName:"p"},"[ComponentName].[ComponentName]_data_source"),". The value of this ",(0,i.mdx)("inlineCode",{parentName:"p"},"provider")," was declared in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"js_config")," block in the XML above. It is possible to pass nearly any configuration value this way and access it using template literals."),(0,i.mdx)("p",null,"But, XML is static and while that gets us the name of the data provider component, it still does not actually provide data. There is one more important step in providing data to JavaScript components."),(0,i.mdx)("h2",{id:"javascript-component-linking"},"JavaScript component linking"),(0,i.mdx)("p",null,"Every JavaScript component should extend the core Element class in some way (mapped to ",(0,i.mdx)("a",{parentName:"p",href:"element.md"},(0,i.mdx)("inlineCode",{parentName:"a"},"uiElement"))," with RequireJS and located in ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4/app/code/Magento/Ui/view/base/web/js/lib/core/element/element.js"},(0,i.mdx)("inlineCode",{parentName:"a"},"Magento/Ui/view/base/web/js/lib/core/element/element.js")),".  When this class initializes it runs an ",(0,i.mdx)("inlineCode",{parentName:"p"},"initLinks()")," method. That method, in turn, passes a few class properties into a method that handles linking components together. This file (",(0,i.mdx)("inlineCode",{parentName:"p"},"lib/core/element/link.js"),") binds the values of those parameters to actual components."),(0,i.mdx)("p",null,"The properties that the application will parse are:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"imports")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exports")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"links"))),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"links")," property is the same as duplicating a value in both ",(0,i.mdx)("inlineCode",{parentName:"p"},"imports")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"exports"),". Each of those properties expect an object that contains key/value pairs to bind the expression to. In the example above, it would appear in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"defaults")," property like this:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"imports: {\n    totalRecords: '${ $.provider }:data.totalRecords'\n}\n")),(0,i.mdx)("p",null,"When the Element class initializes, it will process the link that was declared in ",(0,i.mdx)("inlineCode",{parentName:"p"},"imports"),". Remember that one of the first things the application does is process string literals, though, so it is actually working with something that looks more like the following (where ",(0,i.mdx)("inlineCode",{parentName:"p"},"example")," is the UI Component Name for clarity):"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"imports: {\n    totalRecords: 'example.example_data_source:data.totalRecords'\n}\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},":")," is a special separator that is used to divide the component name that it is to link to and the values it should access in the returned value. No ",(0,i.mdx)("inlineCode",{parentName:"p"},":")," is necessary, though, and the expression, ",(0,i.mdx)("inlineCode",{parentName:"p"},"$.provider")," could be any key that was passed into the JavaScript configuration."),(0,i.mdx)("p",null,"In the example above, it will return the ",(0,i.mdx)("inlineCode",{parentName:"p"},"totalRecords")," property of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"data")," object in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"example.example_data_source")," component. As a result of these connections, ",(0,i.mdx)("inlineCode",{parentName:"p"},"totalRecords")," will display the output of ",(0,i.mdx)("inlineCode",{parentName:"p"},"DataProvider::getData()"),"."))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-ui-components-concepts-data-source-md-e3a74f4110d10bf46f53.js.map